# PE file
> [!info] PE File Structure
> ```text
> +--------------------+
> | DOS Header         |
> +--------------------+
> | DOS Stub           |
> +--------------------+
> | NT Headers (PE)    |
> +--------------------+
> | Section Table      |
> +--------------------+
> | Sections (.text‚Ä¶)  |
> +--------------------+
> ```
### üîπ Entry Point
- N∆°i ch∆∞∆°ng tr√¨nh **b·∫Øt ƒë·∫ßu ch·∫°y**
- Malware **r·∫•t hay l√†m gi·∫£**
üìå Lu√¥n h·ªèi:
> Entry Point n·∫±m ·ªü section n√†o
---
### üîπ ImageBase
- ƒê·ªãa ch·ªâ load PE v√†o RAM
- D√πng ƒë·ªÉ t√≠nh ƒë·ªãa ch·ªâ th·∫≠t
`VA = RVA + ImageBase
--- 
### üîπ Data Directories (ch·ªâ c·∫ßn nh·ªõ 3)
- Import Table
- TLS Callback ‚ö†Ô∏è
- Relocation
---
## 4Ô∏è‚É£ Section ‚Äì ch·ªâ c·∫ßn quan t√¢m 4 ƒëi·ªÉm
### üîπ `.text`
- Ch·ª©a code th·ª±c thi
---
### üîπ Quy·ªÅn section
- RWX ‚Üí üö© r·∫•t nguy hi·ªÉm
---
### üîπ Section l·∫°
- T√™n k·ª≥ qu·∫∑c ‚Üí nghi ng·ªù packed / malware
---
### üîπ Entry Point c√≥ n·∫±m trong `.text` kh√¥ng?
- ‚ùå Kh√¥ng ‚Üí r·∫•t ƒë√°ng nghi
---
## 5Ô∏è‚É£ Import Table (C·ª∞C K·ª≤ QUAN TR·ªåNG)
- Cho bi·∫øt ch∆∞∆°ng tr√¨nh **l√†m g√¨**

üö© D·∫•u hi·ªáu nguy hi·ªÉm:
- Import r·∫•t √≠
- Ch·ªâ c√≥:
`LoadLibrary GetProcAddress`
‚Üí Resolve API ƒë·ªông (hay g·∫∑p ·ªü malware)
---
## 6Ô∏è‚É£ TLS Callback (ƒë·ª´ng b·ªè s√≥t)
- Ch·∫°y **TR∆Ø·ªöC Entry Point**
- Malware hay gi·∫•u code t·∫°i ƒë√¢y
‚ö†Ô∏è R·∫•t nhi·ªÅu ng∆∞·ªùi m·ªõi **kh√¥ng ki·ªÉm tra TLS**
---
## 7Ô∏è‚É£ D·∫•u hi·ªáu PE ƒë√°ng nghi (nh√¨n nhanh)
- Entry Point l·∫°
- Section RWX
- Import r·∫•t √≠t
- Section t√™n l·∫°
- C√≥ TLS Callback
- Entropy cao
# C√°c nh√≥m API c·∫ßn ch√∫ √Ω 

 ## 1Ô∏è‚É£ File / Filesystem APIs

- CreateFileA / CreateFileW
- ReadFile
- WriteFile
- CopyFileA / CopyFileW
- MoveFileA / MoveFileW
- DeleteFileA / DeleteFileW
- GetFileSize
- SetFilePointer
- CloseHandle
--- 
## 2Ô∏è‚É£ Process / Execution APIs
- CreateProcessA / CreateProcessW
- WinExec
- ShellExecuteA / ShellExecuteW
- OpenProcess
- TerminateProcess
- GetCurrentProcess
- GetProcessId
- ExitProcess
- ResumeThread
---
## 3Ô∏è‚É£ Memory APIs
- VirtualAlloc
- VirtualAllocEx
- VirtualFree
- VirtualProtect
- VirtualProtectEx
- ReadProcessMemory
- WriteProcessMemory
- HeapAlloc
- HeapFree
---
## 4Ô∏è‚É£ Registry APIs
- RegOpenKeyA / RegOpenKeyW
- RegCreateKeyA / RegCreateKeyW
- RegSetValueA / RegSetValueW
- RegSetValueExA / RegSetValueExW
- RegQueryValueA / RegQueryValueW
- RegQueryValueExA / RegQueryValueExW
- RegDeleteKeyA / RegDeleteKeyW
- RegCloseKey
---
## 5Ô∏è‚É£ Network / Internet APIs
- InternetOpenA / InternetOpenW
- InternetConnectA / InternetConnectW
- InternetReadFile
- HttpOpenRequestA / HttpOpenRequestW
- HttpSendRequestA / HttpSendRequestW
- URLDownloadToFileA / URLDownloadToFileW
- WSAStartup
- socket
- connect
---
## 6Ô∏è‚É£DLL / Dynamic Loading APIs
- LoadLibraryA / LoadLibraryW
- LoadLibraryExA / LoadLibraryExW
- GetProcAddress
- FreeLibrary
- GetModuleHandleA / GetModuleHandleW
- LdrLoadDll
- LdrGetProcedureAddress
---
## 7Ô∏è‚É£ Thread APIs
- CreateThread
- CreateRemoteThread
- OpenThread
- SuspendThread
- ResumeThread
- ExitThread
- GetCurrentThread
- WaitForSingleObject
---
## 8Ô∏è‚É£ Pivilege / Security APIs
- OpenProcessToken
- LookupPrivilegeValueA / LookupPrivilegeValueW
- AdjustTokenPrivileges
- GetTokenInformation
- ImpersonateLoggedOnUser
- RevertToSelf
- CheckTokenMembership
---
## 9Ô∏è‚É£ Persistence APIs
- RegSetValueExA / RegSetValueExW
- CreateServiceA / CreateServiceW
- OpenServiceA / OpenServiceW
- StartServiceA / StartServiceW
- CopyFileA / CopyFileW
- MoveFileA / MoveFileW
- GetModuleFileNameA / GetModuleFileNameW
---
## üîü Anti-analysis / Evasion APIs
- IsDebuggerPresent
- CheckRemoteDebuggerPresent
- NtQueryInformationProcess
- GetTickCount
- QueryPerformanceCounter
- Sleep
- GetSystemTime
- GetModuleHandleA / GetModuleHandleW